import { Callout } from "nextra/components";

## Example usage of the walletAPIServer

Here's how you can instantiate a new `WalletAPIServer` using its [constructor](../wallet-api-server#constructor)

### instantiation

```ts {21}
const transport: Transport = {
  onMessage: undefined,
  send: (message: string) => {
    if (wapiView) {
      wapiView.webContents.postMessage("message", message);
    }
  },
};

const config = {
  appId: "fake-manifest-id", // should be the real manifest id, used in the storage handler code
  wallet: {
    name: "browserview-wallet",
    version: "0.1.0",
  },
  tracking: false,
  userId: "fake",
};

const wapiServer = new WalletAPIServer(transport, config);
```

two required arguments are passed, [transport](../wallet-api-server#transport) and [config](../wallet-api-server#walletcontextconfig).

### setup permissions

```ts
wapiServer.setPermissions({
  methodIds: [
    "account.list",
    "account.receive",
    "account.request",
    "currency.list",
  ],
});
```

Set the [permissions](../wallet-api-server#permissions) to control which methods the app can access.

<Callout type="info" emoji="ℹ️">
  **Note:** As of version 2.0.0, `setAccounts()` and `setCurrencies()` have been
  removed. You must now implement `account.list` and `currency.list` handlers
  instead.
</Callout>

### set wallet handlers

```ts
// Handler to list all accounts
wapiServer.setHandler("account.list", async () => {
  return accounts.map((account) => accountToWalletAPIAccount(account));
});

// Handler to list all currencies
wapiServer.setHandler("currency.list", async () => {
  return currencies;
});

// Handler to request an account
wapiServer.setHandler("account.request", async ({ accountIds }) => {
  return new Promise((resolve, reject) => {
    uiAccountRequest({
      onSuccess: (account: AccountLike, parentAccount: Account | undefined) => {
        resolve(accountToWalletAPIAccount(account, parentAccount));
      },
      onCancel: () => {
        reject(new Error("Canceled by user"));
      },
    });
  });
});
```

Set [walletHandlers](../wallet-api-server#wallethandlers) to handle wallet operations. The `account.list` and `currency.list` handlers are now required.

### wire up transport

```ts {3}
import { ipcMain } from "electron";
ipcMain.on("walletAPI:postMessage", (_, data) => {
  transport.onMessage?.(data);
});
```

Set up the transport's `onMessage` value, which will allow _APP -> SERVER_ communication.

More on transport [here](../wallet-api-server#transport).
